<!DOCTYPE html>
<html>
<head>
  <title>Login with Firebase</title>
</head>
<body>
  <h2>Login</h2>

  <form id="loginForm" method="POST" action="/login">
    <input type="hidden" name="redirect_uri" id="redirect_uri">
    <input type="hidden" name="state" id="state">
    <input type="hidden" name="client_id" id="client_id">

    <label>Email:</label><br>
    <input type="email" name="email" required><br>
    <label>Password:</label><br>
    <input type="password" name="password" required><br><br>

    <input type="submit" value="Login">
  </form>

  <script>
    const params = new URLSearchParams(window.location.search);
    const redirect_uri = params.get("redirect_uri");
    const state = params.get("state");
    const client_id = params.get("client_id");

    document.getElementById("redirect_uri").value = redirect_uri || "";
    document.getElementById("state").value = state || "";
    document.getElementById("client_id").value = client_id || "";

    // âœ… Ensure action preserves query params on form submit
    const form = document.getElementById("loginForm");
    form.action = `/login?redirect_uri=${encodeURIComponent(redirect_uri)}&state=${encodeURIComponent(state)}&client_id=${encodeURIComponent(client_id)}`;
  </script>
</body>
</html>
